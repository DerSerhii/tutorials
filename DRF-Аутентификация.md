# Аутентификация в DRF

Виды аутентификаций:
- `Аутентификация сессией`
- `Базовая аутентификация`
- `Аутентификация по токену`
- `Внешняя аутентификация`

### Аутентификация сессией

Авторизация происходит один раз, после чего информация о пользователе хранится в "куках" и 
передаётся при каждом запросе.

Алгоритм:
```
CLIENT <<--- HTML-форма для входа   <<--  SERVER
CLIENT --->> POST-запрос            -->>  SERVER > (в БД ищет Userа с указанным логином и паролем)
CLIENT <<--- errors                 <<--  SERVER < (если в БД нет соответтсвий)
                                    <<--  SERVER < (если в БД есть соответствия:
                                                    - формирует идентификатор сесии > session_id: d3N2oBh...
                                                    - заносит идентификатор сессии session_id в БД > id
CLIENT <<--- d3N2oBh..                              - связывает с конкретным user_id > userом из БД)
(сохраняет в cookie)
Если пользователь авторизован и браузере есть cookie c session_id:
CLIENT --->> GET-запрос            -->>  SERVER > (если в БД есть соответствия session_id >
             (в Header:                            дает доступ к закрытым страницам)
             Authorization: Basic d3N2oBh..)
```

Недостатки:
- для того что бы выполнять любые не безопасные методы POST, PUT, PATCH, DELETE необходимо 
использовать CSRF Token, а это значит, что для выполнения таких запросов, необходимо каждый 
раз делать дополнительный запрос, для получения токена.
- такой подход подразумевает, что сервер хранит информацию, о сессиях, такой подход не будет RESTfull.

### Аутентификация по токену

Токен — это специальный вычисляемый набор символов уникальный для каждого пользователя.

Алгоритм:
```
CLIENT <<--- HTML-форма для входа   <<--  SERVER
CLIENT --->> POST-запрос            -->>  SERVER > (в БД ищет Userа с указанным логином и паролем)
CLIENT <<--- errors                 <<--  SERVER < (если в БД нет соответтсвий)
                                    <<--  SERVER < (если в БД есть соответствия:
                                                    - генерирует токен 23dfert...
                                                    - заносит токен в БД > key
CLIENT <<--- 23dfert...                             - связывает с конкретным user_id > userом из БД)
(сохраняет в локальном хранилище)
Если пользователь авторизован и браузере:
CLIENT --->> GET-запрос            -->>  SERVER > (если в БД есть соответствия key >
             (в Header:                            дает доступ к закрытым страницам)
             Authorization: Token 23dfert...)
```

### Аутентификация веб-токена JSON

JSON Web Token — довольно новый стандарт, который можно использовать для аутентификации на 
основе токенов. В отличие от встроенной схемы TokenAuthentication, 
JWT Authentication не требует использования базы данных для проверки токена.
Пакет для аутентификации JWT — djangorestframework-simplejwt, 
который предоставляет некоторые функции, 
а также приложение для черного списка подключаемых токенов.

JWT-токен состоит из трех частей, разделенных точкой (.)

|               Header               |                Payload                |     Signature     |
|:----------------------------------:|:-------------------------------------:|:-----------------:|
|          ewe3{some}2432.           |            sadas{some}d34.            | a-ewrd{some}fsdf  |
|            JSON-строка.            |             JSON-строка.              | объединение строк |
| алгоритм шифрования<br/>тип токена | инфа о user<br/> времени жизни токена |    шифрование     |

Header  = base64urlEncode(b'') --> преобразовывается в последовательность ASCII-символов
Payload  = base64urlEncode(b'') --> преобразовывается в последовательность ASCII-символов
Signature = HMAC-SHA256(header.payload, SECRET_KEY)

**Header & Payload** - кодированы, но шифрованы. Не защищены от просмотра, но менять их не получиться из-за 
третей составляющей **Signature**. В ней Header & Payload объединяются и шифруются.

Конечная структура JWT-токена:

`jwt_token = Header.Payload.Signature`


