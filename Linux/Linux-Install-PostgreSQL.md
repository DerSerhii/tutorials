# PostgreSQL в Ubuntu

`PostgreSQL` или `Postgres` — это система управления реляционными базами данных, 
которая представляет собой реализацию языка запросов SQL. 
Она соответствует стандартам и обладает множеством передовых функций, 
таких как надежность и параллельность операций без блокировки при чтении.

## Установка PostgreSQL
Для установки **PostgreSQL** в первую очередь обновите локальный индекс пакетов  
вашего сервера:
```
$ sudo apt update
```
После этого установите пакет **Postgres** вместе с пакетом `-contrib`,
который содержит дополнительные утилиты и функциональные возможности:
```
$ sudo apt install postgresql postgresql-contrib
```
## Использование ролей и баз данных в PostgreSQL

По умолчанию **Postgres** использует концепцию «ролей» для выполнения 
[аутентификации и авторизации](../Авторизация,аутентификация.md). 
В некоторых аспектах они аналогичны обычным пользователям и группам в Unix.

После установки Postgres настроена на использование аутентификации `ident`, 
что значит, что выполняется привязка ролей **Postgres** с соответствующей 
системной учетной записью Unix/Linux. 
Если роль существует внутри Postgres, пользователь Unix/Linux с тем же именем 
может выполнить вход в качестве этой роли.

В ходе установки создается учетная запись пользователя `postgres`, которая 
связана с используемой по умолчанию ролью `postgres`. 

Существует несколько способов использования этой учетной записи для доступа к 
**Postgres**.


***Способ №1*** — переход к учетной записи `postgres` на вашем сервере с 
помощью следующей команды:
```
$ sudo -i -u postgres
```
Затем получить доступ к командной строке Postgres с помощью команды:
```
$ psql
```
Для выхода из командной строки PostgreSQL:
```
postgres=# \q
```
В результате вернетесь в командную строку postgres в Linux.<br>
Выход из командной строки `postgres@DerSerhiiUbuntu:~$` — `Ctrl+D` 

***Способ №2*** — запустить необходимую команду с учетной записью `postgres` 
напрямую с помощью `sudo`:
```
$ sudo -u postgres psql
```
Это позволит выполнить вход в Postgres без необходимости использования 
промежуточной командной строки `bash`.

Для выхода из командной строки PostgreSQL:
```
postgres=# \q
```

## Создание новой роли
***Способ №1*** — Если вы выполнили вход в учетную запись `postgres`, 
то можете создать новую роль с помощью следующей команды:
```
postgres@DerSerhiiUbuntu:~$ createuser --interactive
```
***Способ №2*** — Если использовать `sudo` для каждой команды без переключения с 
обычной учетной записи, введите следующую команду:
```
$ sudo -u postgres createuser --interactive
```
В любом случае скрипт будет предлагать варианты на выбор и, исходя из ваших ответов,
выполнять нужные команды Postgres для создания пользователя в соответствии с 
вашими спецификациями:
```
Enter name of role to add: TestUser2
Shall the new role be a superuser? (y/n) n
Shall the new role be allowed to create databases? (y/n) n
Shall the new role be allowed to create more new roles? (y/n) n
```
## Создание новой базы данных
***Способ №1*** — Если вы выполнили вход в учетную запись `postgres`, 
то можете создать новую базу данных с помощью следующей команды:
```
postgres@DerSerhiiUbuntu:~$ createdb eshopdb
```
***Способ №2*** — Если использовать `sudo` для каждой команды без переключения с 
обычной учетной записи, введите следующую команду:
```
$ sudo -u postgres createdb eshopdb
```

## Открытие командной строки Postgres с новой ролью
Чтобы выполнить аутентификацию с помощью `ident`, вам потребуется пользователь 
Linux с тем же именем, что и имя роли и базы данных в Postgres.

Если у вас нет соответствующего пользователя Linux, то вы можете создать его с 
помощью команды `adduser`. 
Вы должны воспользоваться учетной записи без прав root с привилегиями sudo 
(т.е. не выполняя вход в качестве пользователя postgres):
```
$ sudo adduser sammy
```
Когда новая учетная запись будет доступна, вы можете переключиться и подключиться к 
базе данных следующим образом:
```
$ sudo -i -u sammy
$ psql
```
Либо же вы можете сделать следующее:
```
$ sudo -u sammy psql
```
Эта команда позволит выполнить вход автоматически, полагая, что все компоненты были настроены должным образом.

Если вы хотите, чтобы ваш пользователь подключился к другой базе данных, то вы 
можете сделать это с помощью следующей команды:
```
$ psql -d postgres
```
После входа вы можете проверить данные о текущем подключении:
```
sammy=# \conninfo

You are connected to database "sammy" as user "sammy" via socket 
in "/var/run/postgresql" at port "5432".
```
