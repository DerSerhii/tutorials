# Менеджеры контекста - with...as

***Менеджеры контекста*** позволяют выделять и освобождать ресурсы *строго по необходимости*. 

Конструкция `with ... as` используется для оборачивания выполнения блока 
инструкций **менеджером контекста**.

Синтаксис конструкции `with ... as`:
```python
"with" expression ["as" target] ("," expression ["as" target])* ":"
    suite
```
Теперь по-порядку о том, что происходит при выполнении данного блока:
1. Выполняется выражение в конструкции `with ... as`.
2. Загружается специальный метод `__exit__` для дальнейшего использования.
3. Выполняется метод `__enter__`. Если конструкция `with` включает в себя слово `as`.
то возвращаемое методом `__enter__` значение записывается в переменную.
4. Выполняется `suite`.
5. Вызывается метод `__exit__`, причём неважно, выполнилось ли `suite` или произошло 
исключение. В этот метод передаются параметры исключения, если оно произошло, 
или во всех аргументах значение `None`, если исключения не было.

Если в конструкции `with...as` было несколько выражений, то это эквивалентно нескольким 
вложенным конструкциям:
```python
with A() as a, B() as b:
    suite
```
эквивалентно
```python
with A() as a:
    with B() as b:
        suite
```
Для чего применяется конструкция `with...as`? <br> 
Для **гарантии** того, что критические функции выполнятся в любом случае !!! <br>
Самый распространённый пример использования этой конструкции - открытие файлов.
Конструкция `with...as` гарантирует *закрытие файла в любом случае*:
```python
with open('newfile.txt', 'w', encoding='utf-8') as g:
    d = int(input())
    print('1 / {} = {}'.format(d, 1 / d), file=g)
```
