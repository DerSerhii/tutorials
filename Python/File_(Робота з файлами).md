# File – Работа с файлами

Прежде, чем работать с файлом, его надо открыть,с этим справится 
[встроенная функция](Python-Built-in-Function(Встроенные%20функции).md)`open()`:
```python
open(file, mode='r', buffering=None, encoding=None, errors=None, newline=None, closefd=True)
```
где: <br>
`file`– путь к файлу (может быть относительным или абсолютным); <br>
`mode`– режим, в котором мы будем открывать файл; <br>
`encoding`– аргумент задает кодировку (нужен только в текстовом режиме чтения файла).

## Mode – режимы открытия файла 

| Режим | Обозначение                                                                                    | 
|:-----:|:-----------------------------------------------------------------------------------------------|
| `'r'` | открытие на чтение (является значением по умолчанию)                                           |
| `'w'` | открытие на запись, содержимое файла удаляется, <br> если файла не существует, создается новый |
| `'x'` | открытие на запись, если файла не существует, иначе исключение                                 |
| `'a'` | открытие на дозапись, информация добавляется в конец файла                                     |
| `'b'` | открытие в двоичном режиме                                                                     |
| `'t'` | открытие в текстовом режиме (является значением по умолчанию)                                  |
| `'+'` | открытие на чтение и запись                                                                    |

Режимы могут быть *объединены*, то есть, к примеру, <br>
`'rb'`– чтение в двоичном режиме. <br> 
По умолчанию установлен режим равен `'rt'`.

## Чтение из файла

Для чтения информации существуют несколько способов:

1) Метод`file.read()` читающий *весь файл целиком*, если был вызван без аргументов, <br> 
и`file.read(n)`символов, если был вызван с аргументом (целым числом`n`).
```python
>>> f = open('text.txt')

>>> f.read(1)
'H'
>>> f.read()
'ello world!\nThe end.\n\n'

>>> f.close()
```

2) Прочитать файл построчно, воспользовавшись [циклом for](Python-Циклы.md):
```python
>>> f = open('text.txt')

>>> for line in f:
...     line
...
'Hello world!\n'
'\n'
'The end.\n'
'\n'

>>> f.close()
```

3) Прочитать файл кусками при помощи [цикла while](Python-Циклы.md).
```python
>>> fp = open('foo.txt', 'r')
# будем читать строку по 10 байт
>>> line = fp.readline(10)
>>> while line:
...     line = line.rstrip('\n')
...     print(line)
...     line = fp.readline(10)
... 
This is 1s
t line
This is 2n
d line
This is 3r
d line

>>> fp.close()
```

4) Операция открытия файла`open()`возвращает поток, представляющий из себя [генератор](Python-Generator(Генератор).md)
строк из файла, то можно итерироваться по нему при помощи [встроенной функции](Python-Built-in-Function(Встроенные%20функции).md)`next()`:
```python
>>> fp = open('foo.txt', 'r')

>>> next(fp)
'This is 1st line\n'
>>> next(fp)
'This is 2nd line\n'
>>> next(fp)
'This is 3rd line\n'
>>> next(fp)
Traceback (most recent call last):
    ...
StopIteration

>>> fp.close()
```

### Метод для чтения`file.readline()`
Метод`file.readline()` – читает файл построчно, возвращает [str(строку)](Python-DataTypes-Str(Строка).md)
в текстовом режиме или байтовый объект в двоичном режиме.
```python
file.readline([size])
```
где:
- `file` – объект файла
- `size` – `int`, количество байт

Метод файла`file.readline()`читает одну целую строку из файла. Конечный символ новой
строки`\n`сохраняется в строке. Метод возвращает одну строку или байтовый объект в 
зависимости от режима, в котором открыт файл функцией`open()`.

Если необязательный аргумент`size`присутствует и неотрицателен, то метод читает строку
частями по`size`байтов, пока не достигнет символ новой строки`\n`. 
Если`size`отрицателен, то считывается строка полностью.

Пустая строка возвращается только тогда, когда достигнут конец файла, 
т.е.`EOF`встречается немедленно.

```python
>>> text = 'This is 1st line\nThis is 2nd line\nThis is 3rd line\n'
>>> fp = open('foo.txt', 'w+')

>>> fp.write(text)
51
>>> fp.seek(0)
0

>>> fp.readline()
'This is 1st line\n'
>>> fp.readline()
'This is 2nd line\n'
>>> fp.readline()
'This is 3rd line\n'
>>> fp.readline()
''

>>> fp.close()
```

### Метод для чтения`file.readlines()` 
Метод`file.readlines()` – возвращает [list(список)](Python-DataTypes-List(Список).md) 
строк файла в текстовом режиме или байтовых объектов в двоичном режиме.

```python
file.readlines([sizehint])
```
где:
- `file` – объект файла
- `sizehint` – `int`, количество байт

Метод файла`file.readlines()` читает файловый объект`file`построчно, пока не 
достигнет конца файла`EOF`и возвращает список, содержащий строки или байтовые объекты
файла в зависимости от режима, в котором открыт файл функцией`open()`.
Конечный символ новой строки`\n`сохраняется в строке.

Если присутствует необязательный аргумент`sizehint`, то читаются целые строки,
составляющие приблизительно`sizehint`байт (округляется до внутреннего размера буфера).

Пустая строка возвращается только по достижении конца файла, т.е.`EOF`встречается 
немедленно.

Помните, что файл может быть слишком большим для того чтобы разместиться полностью в 
оперативной памяти. В этом случае лучше считывать и обрабатывать файл кусками.

```python
>>> text = 'This is 1st line\nThis is 2nd line\nThis is 3rd line\n'

>>> fp = open('foo.txt', 'w+')
>>> fp.write(text)
51
>>> fp.seek(0)
0

>>> fp.readlines()
['This is 1st line\n', 'This is 2nd line\n', 'This is 3rd line\n']

>>> fp.seek(0)
0

>>> fp.readlines(15)
['This is 1st line\n']
>>> fp.readlines(20)
['This is 2nd line\n', 'This is 3rd line\n']
>>> fp.readlines(20)
[]

>>> fp.close()
```

## Запись в файл

Запись в файл осуществляется с помощью метода `.write()`:
```python
>>> f = open('text.txt', 'w')

>>> for index in [str(i)+str(i-1) for i in range(5)]:
...     f.write(index + '\n')
...    

>>> f.close()
```


## Указатель позиции
Метод`file.seek()` – перемещает указатель в файле, возвращает `int` – новую позицию 
указателя.
```python
file.seek(offset[, whence])
```
- `file` – объект файла;
- `offset` – `int`байт, смещение указателя чтения/записи файла;
- `whence` – `int`, абсолютное позиционирование указателя.

Метод файла`file.seek()`устанавливает текущую позицию в байтах`offset`для указателя
чтения/записи в файле`file`.

Аргумент`whence`является необязательным и по умолчанию равен`0`. <br>
Может принимать другие значения:
- `0` - означает, что нужно сместить указатель на`offset`относительно начала файла.
- `1` - означает, что нужно сместить указатель на`offset` относительно относительно
текущей позиции.
- `2` - означает, что нужно сместить указатель на`offset`относительно конца файла.

Важно:
- Если файл открыт для добавления с помощью`'a'`или`'a+'`, все 
операции`file.seek()`будут отменены при следующей записи.
- Если файл открыт только для записи в режиме добавления с использованием`'a'`, 
метод по существу используется, но он остается полезным для файлов, открытых в режиме
добавления с включенным чтением - режим `'a+'`.
- Если файл открыт в текстовом режиме с помощью`'t'`, то допустимы только смещения,
возвращаемые функцией`file.tell()`. Использование других смещений вызывает 
неопределенное поведение.
- Не все объекты файлов доступны для метода`file.seek()`. В текстовых файлах 
разрешены только запросы относительно начала файла, исключение составляет смещение 
указателя до самого конца файла с помощью`txt_file.seek(0, 2)`.
```python
>>> text = b'This is 1st line\nThis is 2nd line\nThis is 3rd line\n'

>>> fp = open('foo.txt', 'bw+')
>>> fp.write(text)
51

>>> fp.seek(20, 0)
20
>>> fp.read(10)
b's is 2nd l'

>>> fp.seek(10, 1)
40
>>> fp.read(10)
b's 3rd line'

>>> fp.seek(-11, 2)
40
>>> fp.read(10)
b's 3rd line'

>>> fp.close()
```
``
## Закрытие файла
После окончания работы с файлом его обязательно нужно закрыть с помощью 
метода `file.close()`:
```python
>>> f.close()
```
### Автоматическое закрытие с`with` 
Функцию`open()`предпочтительнее использовать с оператором контекстного 
менеджера`with`. 

При использовании оператора`with`файл закрывать не нужно:
```python
text = 'This is 1st line\nThis is 2nd line\nThis is 3rd line\n'

with open('foo.txt', 'w') as fp:
    fp.write(text)
#51

# читаем построчно с помощью `fp.readlines()`
with open('foo.txt', 'r') as fp:
    data = fp.readlines()

print(data)
# ['This is 1st line\n', 'This is 2nd line\n', 'This is 3rd line\n']

with open('foo.txt', 'r') as fp:
    for line in fp:
        print(line.rstrip('\n'))

# This is 1st line
# This is 2nd line
# This is 3rd line
```
