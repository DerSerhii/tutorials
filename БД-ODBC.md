# Уровни изоляции транзакций (ODBC)

***Уровни изоляции транзакций*** — это мера степени, в которой выполняется изоляция транзакции. В частности, уровни изоляции транзакций определяются присутствием или отсутствием следующих явлений:

- __`"Грязные" операции чтения`__ <br> «Грязное» чтение происходит, когда транзакция считывает данные, которые 
еще не были зафиксированы.<br> *Например*, транзакция 1 обновляет строку. Транзакция 2 считывает обновленную строку до того, как транзакция 1 зафиксирует обновление. Если транзакция 1 выполняет откат изменений, то транзакция 2 будет считать данные, которые никогда не существовали.

- __`Неповторяемые операции чтения`__<br> Неповторяемое чтение происходит, когда транзакция дважды считывает 
одну и ту же строку, но каждый раз получает разные данные. <br>*Например*, транзакция 1 считывает строку. Транзакция 2 обновляет или удаляет эту строку и фиксирует обновление или удаление. Если транзакция 1 пересчитывает строку, она получает различные значения строки или обнаруживает, что строка была удалена.

- __`Фантомы`__ <br> Фантом — это строка, которая соответствует условиям поиска, но изначально не отображается.
*Например*, транзакция 1 считывает набор строк, удовлетворяющих некоторым условиям поиска. Транзакция 2 создает новую строку (посредством обновления или вставки), которая соответствует условиям поиска для транзакции 1. Если транзакция 1 выполняет инструкцию, которая считывает строки, она получает другой набор строк.

***Четыре уровня изоляции транзакций*** (как определено SQL-92) определяются с точки зрения этих явлений. 
В следующей таблице «X» отмечает каждое обнаруженное явление.

| Уровень изоляции транзакции                               | "Грязных" операций чтения | Неповторяемые операции чтения | Фантомы |
|:----------------------------------------------------------|:-------------------------:|:-----------------------------:|:-------:|
| Уровень изоляции <br>**Read uncommitted**                 |             X             |               X               |    X    |
| Уровень изоляции <br>**Read committed**                   |            --             |               X               |    X    |
| Уровень изоляции <br>**Repeatable read**                  |            --             |              --               |    X    |
| **Упорядочиваемый** <br>уровень изоляции **Serializable** |            --             |              --               |   --    |

В следующей таблице описаны простые способы, с помощью которых СУБД может реализовать уровни изоляции транзакций.

| Изоляция транзакций	                                  | Возможная реализация                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
|-------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Уровень изоляции <br>**Read uncommitted**             | Транзакции не изолированы друг от друга. <br>Если СУБД поддерживает другие уровни изоляции транзакций, она игнорирует любой механизм, используемый для реализации этих уровней. Так что они не оказывают негативного воздействия на другие транзакции, транзакции, выполняющиеся на уровне READ UNCOMMITTED, обычно доступны только для чтения.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| Уровень изоляции <br>**Read committed**               | Транзакция ожидает, пока разблокируются строки, заблокированные другими транзакциями. Это предотвращает считывание "грязных" данных. <br>Транзакция содержит блокировку чтения (если она считывает только строку) или блокировку записи (если она обновляет или удаляет строку) в текущей строке, чтобы предотвратить ее обновление или удаление другими транзакциями. Транзакция освобождает блокировки чтения при перемещении из текущей строки. Он хранит блокировки записи, пока не зафиксируется или не вернется.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| Уровень изоляции <br>**Repeatable read**              | Транзакция ожидает, пока разблокируются строки, заблокированные другими транзакциями. Это предотвращает считывание "грязных" данных. <br>Транзакция содержит блокировки чтения для всех строк, которые она возвращает в приложение, и блокировки записи для всех строк, которые она вставляет, обновляет или удаляет. например, если транзакция включает в себя инструкцию SQL SELECT * FROM orders, транзакция read-locks блокируется по мере их выборки приложением. если транзакция включает инструкцию SQL DELETE из orders, где Status = ' CLOSED ', то транзакция write-locks блокирует строки при их удалении. <br>Поскольку другие транзакции не могут обновлять или удалять эти строки, текущая транзакция позволяет избежать неповторяемых операций чтения. Транзакция освобождает свои блокировки при фиксации или откате.                                                                                                                                                                                                                                                                                                                                                                                                        |
| **Упорядочиваемый** уровень изоляции **Serializable** | Транзакция ожидает, пока разблокируются строки, заблокированные другими транзакциями. Это предотвращает считывание "грязных" данных. <br>Транзакция удерживает блокировку чтения (если она считывает только строки) или блокировку записи (если она может обновлять или удалять строки) в диапазоне строк, на которые он влияет. например, если транзакция включает в себя инструкцию SQL SELECT * FROM orders, то диапазон является всей таблицей orders; транзакция read-блокирует таблицу и не допускает вставку новых строк в нее. если транзакция включает инструкцию SQL DELETE из заказов, где status = "closed", то диапазоном являются все строки с состоянием "закрыто"; транзакция Write-блокирует все строки в таблице Orders с состоянием "CLOSED" и не позволяет вставлять или обновлять строки таким же, что результирующая строка имеет состояние "CLOSED". <br>Поскольку другие транзакции не могут обновлять или удалять строки в диапазоне, текущая транзакция позволяет избежать неповторяемых операций чтения. Поскольку другие транзакции не могут вставлять какие-либо строки в диапазоне, текущая транзакция позволяет избежать каких-либо фантомов. Транзакция освобождает свою блокировку при фиксации или откате. |

Статья [тут](https://docs.microsoft.com/ru-ru/sql/odbc/reference/develop-app/transaction-isolation-levels?view=sql-server-ver16) 