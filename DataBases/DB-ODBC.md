# Уровни изоляции транзакций (ODBC)

***Уровни изоляции транзакций*** — это мера степени, в которой выполняется изоляция
транзакции. В частности, уровни изоляции транзакций определяются присутствием или
отсутствием следующих явлений:

##  Побочные эффекты параллельных транзакций  
### Грязное чтение / Dirty Read <br> 
**«Грязное» чтение происходит, когда транзакция считывает данные, которые 
еще не были зафиксированы.**<br> 
*Например*: <br>
Транзакция 1 обновляет строку. <br>
Транзакция 2 считывает обновленную строку до того, как транзакция 1 зафиксирует
обновление. <br>
Если транзакция 1 выполняет откат изменений, то транзакция 2 будет считать данные,
которые *никогда не существовали*.

### Неповторяющееся чтение / Non-Repeatable Read
**Неповторяемое чтение происходит, когда транзакция дважды считывает 
одну и ту же строку, но каждый раз получает разные данные.** <br>
*Например*: <br>
Транзакция 1 считывает строку. <br>
Транзакция 2 обновляет или удаляет эту строку и фиксирует обновление или удаление. <br>
Если транзакция 1 пересчитывает строку, она получает *различные значения строки* 
или обнаруживает, что строка была удалена.

### Фантомное чтение / Phantom Reads
**Фантом — это строка, которая соответствует условиям поиска, но изначально не 
отображается.**
*Например*: <br>
Транзакция 1 считывает набор строк, удовлетворяющих некоторым условиям поиска. <br>
Транзакция 2 создает новую строку (посредством обновления или вставки), которая 
соответствует условиям поиска для транзакции 1. <br>
Если транзакция 1 выполняет инструкцию, которая считывает строки, она получает 
другой набор строк.

## Уровни изоляции транзакций
***Четыре уровня изоляции транзакций*** (как определено SQL-92) определяются с точки зрения этих явлений. 
В следующей таблице «X» отмечает каждое обнаруженное явление.

| Уровень изоляции транзакции | "Грязные" чтения | Неповторяемые чтения | Фантомы |
|:----------------------------|:----------------:|:--------------------:|:-------:|
| **Read uncommitted**        |        X         |          X           |    X    |
| **Read committed**          |        --        |          X           |    X    |
| **Repeatable read**         |        --        |          --          |    X    |
| **Serializable**            |        --        |          --          |   --    |

В следующей таблице описаны простые способы, с помощью которых СУБД может реализовать уровни изоляции транзакций.

| Уровень изоляции транзакций	 | Возможная реализация                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Read committed**           | — Транзакция ожидает, пока разблокируются строки, заблокированные другими транзакциями. Это предотвращает считывание **"грязных" данных**. <br> Транзакция содержит блокировку чтения (если она считывает только строку) или блокировку записи (если она обновляет или удаляет строку) в текущей строке, чтобы предотвратить ее обновление или удаление другими транзакциями. Транзакция освобождает блокировки чтения при перемещении из текущей строки. Он хранит блокировки записи, пока не зафиксируется или не вернется.                                                                                                                                                                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
| **Repeatable read**          | — Транзакция ожидает, пока разблокируются строки, заблокированные другими транзакциями. Это предотвращает считывание **"грязных" данных**. <br> — Транзакция содержит блокировки чтения для всех строк, которые она возвращает в приложение, и блокировки записи для всех строк, которые она вставляет, обновляет или удаляет. <br>Поскольку другие транзакции не могут обновлять или удалять эти строки, текущая транзакция позволяет избежать **неповторяемых операций чтения**. Транзакция освобождает свои блокировки при фиксации или откате.                                                                                                                                                            |
| **Serializable**             | — Транзакция ожидает, пока разблокируются строки, заблокированные другими транзакциями. Это предотвращает считывание **"грязных" данных**. <br>— Транзакция удерживает блокировку чтения (если она считывает только строки) или блокировку записи (если она может обновлять или удалять строки) в диапазоне строк, на которые он влияет. <br>Поскольку другие транзакции не могут обновлять или удалять строки в диапазоне, текущая транзакция позволяет избежать неповторяемых операций чтения. Поскольку другие транзакции не могут вставлять какие-либо строки в диапазоне, текущая транзакция позволяет избежать каких-либо **фантомов**. Транзакция освобождает свою блокировку при фиксации или откате. |

Статья [тут](https://docs.microsoft.com/ru-ru/sql/odbc/reference/develop-app/transaction-isolation-levels?view=sql-server-ver16) 